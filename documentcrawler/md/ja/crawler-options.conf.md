# クロール・オプションの構成
データ・クローラーは、最終的に Retrieve and Rank サービスの検索結果の形成に使用される生データを収集します。

データ・クローラーには、以下のリポジトリーからのデータ収集をサポートするコネクターが用意されています。

*	ファイル・システム
*	データベース (JDBC 経由)
*	CMIS (Content Management Interoperability Services)
*	SMB (Server message Block)、CIFS (Common Internet File System)、または Samba ファイル共有
*	SharePoint および SharePoint Online
*	BOX

コネクターをカスタマイズできるコネクター構成テンプレートも用意されています。

## はじめに:
クローラーは、データ・リポジトリーをクロールする時に、ユーザー指定の開始シード URL から処理を始めて、情報のページをダウンロードしていきます。クローラーは、ダウンロードしたページに含まれているリンクも見つけて、新しくディスカバーしたページをさらにクロールするためのスケジュールを設定します。

構成情報を使用して、クロールする必要のあるページやクロールの方法が決定されます。コネクターごとに構成できるオプションをこのファイルで説明します。

**注**: 各コネクターには、対応するシード構成ファイルもあります。シード構成オプションについては、別途説明します。

### ファイル・システム・コネクターの構成
ファイル・システム・コネクターを使用すると、データ・クローラーのインストール済み環境に対してローカルのファイルをクロールできます。以下に、ファイル・システム・コネクターを使用する際に必要な基本構成オプションを示します。
これらの値を設定するには、`config/connectors/filesystem.conf` ファイルを開き、それぞれのユース・ケースに合わせて以下の値を変更します。

*  **protocol** - クロールに使用するコネクター・プロトコルの名前。このコネクターには、`sdk-fs` を使用します。
*  **collection** - この属性は、一時ファイルの解凍に使用します。
*  **logging-config** - ロギング・オプションの構成に使用するファイルを指定します。これは、`log4j` XML ストリングとしてフォーマット設定する必要があります。
*  **classname** - コネクターの Java クラス名。このコネクターを使用する場合の値は、`plugin:filesystem.plugin@filesystem` でなければなりません。

### データベース・コネクターの構成
データベース・コネクターを使用すると、カスタム SQL コマンドを実行して、行 (レコード) ごとに 1 つの文書、および列 (フィールド) ごとに 1 つのコンテンツ・エレメントを作成することにより、データベースをクロールできます。固有キーとして使用する列のほかに、各レコードの最終変更日を表すタイム・スタンプを含む列も指定できます。このコネクターは、指定したデータベースからすべてのレコードを取得します。また、このコネクターを SQL ステートメント内の特定のテーブル、結合などに制限することもできます。

データベース・コネクターを使用すると、以下のデータベースをクロールできます。

*  IBM DB2
*  MySQL
*  Oracle
*  PostgreSQL
*  Microsoft SQL Server
*  Sybase
*  その他の SQL 準拠のデータベース (JDBC 3.0 準拠のドライバーを経由)

このコネクターは、指定したデータベースとテーブルからすべてのレコードを取得します。

**JDBC ドライバー**
データベース・コネクターは、Oracle JDBC (Java Database Connectivity) ドライバーのバージョン 1.5 に付属しています。
データ・クローラーに付属のサード・パーティー JDBC ドライバーは、データ・クローラーをインストールしたディレクトリーの `/lib/java/database` にあります。このディレクトリーで、これらのドライバーを必要に応じて追加、削除、変更できます。`crawler.conf` ファイル内の `extra_jars_dir` 設定を使用して、別の場所を指定することもできます。

***DB2 JDBC ドライバー***
ライセンスの問題により、データ・クローラーには、DB2 用の JDBC ドライバーは付属していません。ただし、JDBC サポートがインストールされているすべての DB2 インストール済み環境には、データ・クローラーが DB2 インストール済み環境をクロールできるようにするために必要な JAR ファイルが含まれています。DB2 インスタンスをクロールするには、データ・クローラーのインストール済み環境内の該当するディレクトリーにこれらのファイルをコピーして、データベース・コネクターでこれらのファイルを使用できるようにする必要があります。

データ・クローラーで DB2 インストール済み環境をクロールできるようにするには、DB2 インストール済み環境内で `db2jcc.jar` とライセンス (通常は `db2jcc_license_cu.jar`) JAR ファイルを見つけ、これらのファイルをデータ・クローラーのインストール・ディレクトリーの `lib/java` サブディレクトリーにコピーします。あるいは、`crawler.conf` ファイルにある `extra_jars_dir` 設定を使用して、別の場所を指定できます。

***MySQL JDBC ドライバー***
製品の一部として配布された場合にライセンスの問題が生じる可能性があるため、data crawler には MySQL 用の JDBC ドライバーは付属していません。ただし、以下のように、MySQL JDBC ドライバーが含まれている JAR ファイルをダウンロードして、その JAR ファイルをデータ・クローラーのインストール済み環境に統合するのは、極めて簡単です。

1.	Web ブラウザーを使用して MySQL のダウンロード・サイトにアクセスし、使用するアーカイブ形式 (通常、Microsoft Windows システムの場合は zip、Linux システムの場合は gzip された tarball) のソースとバイナリーのダウンロード・リンクを見つけます。そのリンクをクリックすると、ダウンロード・プロセスが開始されます。登録が必要な場合があります。

2.	該当する `unzip archive-file-name` コマンドまたは `tar zxf archive-file-name` コマンドを使用し、ダウンロードしたアーカイブ・ファイルのタイプと名前に基づいて、そのアーカイブの内容を解凍します。

3.	アーカイブ・ファイルの解凍先のディレクトリーに移動し、そのディレクトリーからデータ・クローラーのインストール・ディレクトリーの `lib/java` サブディレクトリーに JAR ファイルをコピーします。あるいは、`crawler.conf` ファイルの `extra_jars_dir` 設定を使用して別の場所を指定することもできます。

以下に、データベース・コネクターを使用する際に必要な基本構成オプションを示します。これらの値を設定するには、`config/connectors/database.conf` ファイルを開き、それぞれのユース・ケースに合わせて以下の値を変更します。

*  **protocol** - クロールに使用するコネクター・プロトコルの名前。このコネクターの値は、アクセスするデータベース・システムに基づいています。
*  **collection** - この属性は、一時ファイルの解凍に使用します。
*  **classname** - コネクターの Java クラス名。このコネクターを使用する場合の値は、`plugin:database.plugin@database` でなければなりません。
*  **logging-config** - ロギング・オプションの構成に使用するファイルを指定します。これは、`log4j` XML ストリングとしてフォーマット設定する必要があります。

### CMIS コネクターの構成
CMIS (Content Management Interoperability Services) コネクターを使用すると、CMIS 対応の CMS (Content Management System) リポジトリー (Alfresco、Documentum、IBM Content Manager など) をクロールし、それらに含まれているデータにインデックスを付けることができます。

以下に、CMIS コネクターを使用する際に必要な基本構成オプションを示します。これらの値を設定するには、`config/connectors/cmis.conf` ファイルを開き、それぞれのユース・ケースに合わせて以下の値を変更します。

*  **protocol** - クロールに使用するコネクター・プロトコルの名前。このコネクターには `cmis` を使用します。
*  **collection** - この属性は、一時ファイルの解凍に使用します。
*  **dns** - このオプションは使用されません。
*  **classname** - コネクターの Java クラス名。このコネクターを使用する場合の値は、`plugin:cmis-v1.1.plugin@connector` でなければなりません。
*  **logging-config** - ロギング・オプションの構成に使用するファイルを指定します。これは、`log4j` XML ストリングとしてフォーマット設定する必要があります。
*  **endpoint** - CMIS 準拠のリポジトリーのサービス・エンドポイント URL。例えば、SharePoint の URL 構造は、以下のようになります。
   *  AtomPub バインディングの場合:   
      http://<server>:<port>/_vti_bin/cmis/rest?getRepositories
   *  WebServices バインディングの場合:   
      http://<server>:<port>/_vti_bin/cmissoapwsdl.aspx

*  **username** - コンテンツへのアクセスに使用する CMIS リポジトリー・ユーザーのユーザー名。
このユーザーは、クロールとインデックス付けの対象となるすべてのフォルダーと文書へのアクセス権限を持っている必要があります。
*  **password** - コンテンツへのアクセスに使用する CMIS リポジトリーのパスワード。パスワードは暗号化せず、プレーン・テキストで指定してください。
*  **repositoryid** - CMIS リポジトリーのコンテンツへのアクセスに使用する その具体的な CMIS リポジトリーの ID。
*  **bindingtype** - CMIS リポジトリーへの接続に使用するバインディングのタイプを識別します。値は、`AtomPub` または `WebServices` のいずれかです。
*  **authentication** - CMIS 互換リポジトリーへの接続時に使用する認証メカニズムのタイプ (`Basic HTTP Authentication`、`NTLM`、または `WS-Security(ユーザー名トークン)`) を識別します。
*  **enable-acl** - クロールされたデータの ACL を取得できるようにします。このコレクション内の文書のセキュリティーを考慮しない場合は、このオプションを無効にすると、文書でこの情報が要求されず、この情報の取得やエンコードが行われないため、パフォーマンスが向上します。値は、`true` または `false` のいずれかです。
*  **user-agent** - 文書をクロールする際にサーバーに送信されるヘッダー。
*  **method** - パラメーターを渡すときに使用するメソッド (`GET` または `POST`)。
*  **url-logging** - クロールされた URL をログに記録する範囲。可能な値は、以下のとおりです。

   *  ***full-logging*** - その URL に関する情報をすべてログに記録します。
   *  ***refined-logging*** - クローラー・ログの参照に必要な情報およびコネクターが正しく機能するために必要な情報のみをログに記録します。これがデフォルト値です。
   *  ***minimal-logging*** - コネクターが正しく機能するために必要な最小限の情報のみをログに記録します。

   このオプションを minimal-logging に設定すると、ログのサイズが小さくなり、ログに記録されるデータ量が最少化されて入出力が減少するため、パフォーマンスが若干向上します。
*  **ssl-version** - HTTPS 接続に使用する SSL のバージョンを指定します。デフォルトでは、使用可能な最強のプロトコルが使用されます。

### SMB/CIFS/Samba コネクターの構成
Samba コネクターを使用すると、Server Message Block (SMB) および Common Internet File System (CIFS) ファイル共有をクロールできます。このタイプのファイル共有は Windows ネットワーク上で一般的であり、オープン・ソース・プロジェクト [Samba](https://www.samba.org/) を介しても提供されます。

以下に、Samba コネクターを使用する際に必要な基本構成オプションを示します。これらの値を設定するには、`config/connectors/samba.conf` ファイルを開き、それぞれのユース・ケースに合わせて以下の値を変更します。

*  **protocol** - クロールに使用するコネクター・プロトコルの名前。このコネクターを使用する場合の値は、`smb` です。
*  **collection** - この属性は、一時ファイルの解凍に使用します。
*  **classname** - コネクターの Java クラス名。このコネクターを使用する場合の値は、`plugin:smb.plugin@connector` でなければなりません。
*  **logging-config** - ロギング・オプションの構成に使用するファイルを指定します。これは、`log4j` XML ストリングとしてフォーマット設定する必要があります。
*  **username** - 認証で使用する Samba ユーザー名。指定する場合は、ドメインとパスワードも指定する必要があります。指定しない場合は、ゲスト・アカウントが使用されます。
*  **password** - 認証で使用する Samba パスワード。ユーザー名を指定する場合、これは必須です。パスワードは、データ・クローラーに付属の VCrypt プログラムを使用して暗号化する必要があります。
*  **archive** - アーカイブ・ファイル内の圧縮されたファイルを Samba コネクターでクロールし、インデックスを付けられるようにします。値は `true` または `false` のいずれかで、デフォルト値は `false` です。
*  **max-policies-per-handle** - 単一の RPC ハンドル用に開くことができるローカル・セキュリティー権限 (LSA) ポリシーの最大数を指定します。これらのポリシーによって、さまざまな条件下で特定のシステムを照会または変更する際に必要なアクセス許可が定義されます。このオプションのデフォルト値は `255` です。
*  **crawl-fs-metadata** - このオプションをオンにすると、データ・クローラーによって、ファイルに関する使用可能なファイル・システムのメタデータ (作成日、最終変更日、ファイル属性など) を含む VXML 文書が追加されます。
*  **enable-arc-connector** - このオプションは使用されません。
*  **disable-indexes** - 無効化するインデックスの改行で区切られたリスト。これにより、クロールの速度が上がる場合があります。以下に例を示します。

   *  disable-url-index
   *  disable-error-state-index
   *  disable-crawl-time-index
*  **exact-duplicates-hash-size** - 完全重複を解決するためのハッシュ・テーブルのサイズを設定します。この数値を変更する場合は、十分な注意が必要です。選択する値は最適なものにする必要があります。サイズを大きくすると、検索の速度が上がる可能性がありますが、より多くのメモリーが必要になります。サイズを小さくすると、クロールの速度が低下する可能性がありますが、メモリー使用量がかなり削減されます。
*  **user-agent** - このオプションは使用されません。
*  **timeout** - このオプションは使用されません。
*  **n-concurrent-requests** - 単一の IP アドレスと同時に送信される要求の数。デフォルトは `1` です。
*  **enqueue-persistence** - このオプションは使用されません。

### SharePoint コネクターの構成
SharePoint コネクターを使用すると、SharePoint Server と SharePoint Online オブジェクトをクロールし、それらのオブジェクトに含まれる情報にインデックスを付けることができます。文書、ユーザー・プロファイル、サイト・コレクション、ブログ、リスト項目、メンバーシップ・リスト、ディレクトリー・ページなどのオブジェクトには、それに関連付けられたメタデータとともにインデックスを付けることができます。リスト項目と文書の場合、インデックスに添付ファイルを含めることができます。

**注**: SharePoint コネクターでは、SharePoint オブジェクトの具体的なタイプ (ブログ、文書、ユーザー・プロファイルなど) とは関係なく、すべての SharePoint オブジェクト上の `noindex` 属性が重視されます。それぞれの結果ごとに単一の文書が返されます。

**重要**: SharePoint サイトのクロールに使用する SharePoint アカウントには、少なくとも完全な読み取りアクセス特権が必要です。

以下に、SharePoint コネクターを使用する際に必要な基本構成オプションを示します。
これらの値を設定するには、`config/connectors/sharepoint.conf` ファイルを開き、それぞれのユース・ケースに合わせて以下の値を変更します。

*  **protocol** - クロールに使用するコネクター・プロトコルの名前。このコネクターには、`io-sp` を使用します。
*  **collection** - この属性は、一時ファイルの解凍に使用します。
*  **classname** - コネクターの Java クラス名。このコネクターを使用する場合の値は、`plugin:io-sharepoint.plugin@connector` でなければなりません。
*  **logging-config** - ロギング・オプションの構成に使用するファイルを指定します。これは、`log4j` XML ストリングとしてフォーマット設定する必要があります。
*  **seed-url-type** - 指定されたシード URL が指す SharePoint オブジェクトのタイプ (サイト・コレクションまたは Web アプリケーション (仮想サーバーとも呼ばれます)) を識別します。


   *  ***Site Collections*** - シード URL のタイプが`サイト・コレクション`に設定されている場合は、URL によって参照されるサイト・コレクションの
      子のみがクロールされます。
   *  ***Web Applications*** - シード URL のタイプが `Web アプリケーション`に設定されている場合は、各 URL によって参照される Web アプリケーションに属するすべてのサイト・コレクション (およびそれらの子) がクロールされます。
*  **auth-type** - SharePoint サーバーに接続する際に使用する認証メカニズム (`BASIC`、`NTLM2`、`KERBEROS`、または `CBA`)。デフォルトの認証タイプは `NTLM2` です。
*  **spUser** - コンテンツへのアクセスに使用する SharePoint ユーザーのユーザ名。このユーザーは、クロールとインデックス付けの対象となるすべてのサイトとリストへのアクセス権限を持っている必要があります。また、関連する許可を取得し、解決できなければなりません。`MYDOMAIN\\Administrator` のように、ドメイン名を付けて入力することをお勧めします。
*  **spPassword** - コンテンツへのアクセスに使用する SharePoint ユーザーのパスワード。パスワードは、Data Crawler に付属の vcrypt プログラムを使用して暗号化する必要があります。
*  **cba-sts** - クロール・ユーザーの認証を試みる際に使用されるセキュリティー・トークン・サービス (STS) エンドポイントの URL。ADFS を使用する SharePoint オンプレミスの場合、これは ADFS エンドポイントでなければなりません。認証タイプが `CBA` (クレーム・ベース認証) に設定されている場合、このフィールドは必須です。
*  **cba-realm** - STS からセキュリティー・トークンを要求する際に使用する中継パーティー・トラスト ID。これは、「AppliesTo」値、または「レルム」とも呼ばれます。SharePoint Online の場合、これは、SharePoint Online インスタンスのルートへの URL (例えば `https://mycompany.sharepoint.com`) でなければなりません。ADFS の場合、これは、SharePoint と ADFS の間の中継パーティー・トラストの ID 値 (例えば `"urn:SHAREPOINT:adfs"`) です。
*  **everyone-group** - 指定すると、すべてのユーザーにアクセス権限を付与する必要がある場合に、ACL でこのグループ名が使用されます。ユーザー・プロファイルのクロールが有効である場合、このフィールドは必須です。
**注** - Retrieve and Rank サービスでは、セキュリティーはまだ重視されていません。
*  **user-profile-master-url** - ユーザー・プロファイルへのリンクを構築する際にコネクターで使用されるベース URL。これは、ユーザー・プロファイルの表示画面形式を指すように構成する必要があります。トークン `%FIRST_SEED%` が検出されると、これは最初のシード URL に置き換えられます。ユーザー・プロファイルのクロールが有効である場合は必須です。
*  **urls** - クロールする SharePoint Web アプリケーションまたはサイト・コレクションの HTTP URL の改行で区切られたリスト。
*  **ehcache-config** - このオプションは使用されません。
*  **method** - パラメーターを渡すときに使用するメソッド (`GET` または `POST`)。
*  **cache-types** - このオプションは使用されません。
*  **cache-size** - このオプションは使用されません。
*  **enable-acl** - SharePoint ユーザー・プロファイルのクロールを有効にします。値は、`true` または `false`です。デフォルト値は `false` です。

### Box コネクターの構成
Box コネクターを使用すれば、社内の Box インスタンスをクロールし、そこに含まれている情報のインデックスを生成できます。以下に、Box コネクターを使用する際に必要な基本構成オプションを示します。これらの値を設定するには、`config/connectors/box.conf` ファイルを開き、それぞれのユース・ケースに合わせて以下の値を変更します。

*  **protocol** - クロールに使用するコネクター・プロトコルの名前。このコネクターには `box` を使用します。
*  **classname** - コネクターの Java クラス名。このコネクターを使用する場合の値は、`plugin:box.plugin@connector` でなければなりません。
*  **logging-config** - ロギング・オプションの構成に使用するファイルを指定します。これは、`log4j` XML ストリングとしてフォーマット設定する必要があります。
*  **box-crawl-seed-url** - Box のベース URL。このコネクターの値は、`box://app.box.com/` です。さまざまなタイプの URL をクロールできます。例えば、以下のようなタイプがあります。

   *  ***全社レベルでクロールする場合***: `box://app.box.com/`
   *  ***特定のフォルダーをクロールする場合***: `box://app.box.com/user/USER_ID/folder/FOLDER_ID/FolderName`
   *  ***特定のユーザーをクロールする場合***: `box://app.box.com/user/USER_ID/`
*  **client-id** - Box アプリケーションの作成時に Box から提供されたクライアント ID を入力します。
*  **client-secret** - Box アプリケーションの作成時に Box から提供されたクライアント秘密鍵を入力します。
*  **path-to-private-key** - ローカル・ファイル・システム上の秘密鍵の場所です。これは、Box との通信のために生成される秘密鍵/公開鍵ペアの一方となります。
*  **kid** - 公開鍵 ID を指定します。これは、Box との通信のために生成される秘密鍵/公開鍵ペアのもう一方となります。
*  **enterprise-id** - アプリケーションを許可した企業。企業 ID は、Box の管理者コンソールのメインページに表示されます。
*  **enable-acl** - 内部使用のみ。クロールしたデータの ACL の取得を有効にします。
*  **user-agent** - 文書をクロールする際にサーバーに送信されるヘッダー。
*  **method** - パラメーターを渡すときに使用するメソッド (`GET` または `POST`)。
*  **url-logging** - クロールされた URL をログに記録する範囲。可能な値は、以下のとおりです。

   *  ***full-logging*** - その URL に関する情報をすべてログに記録します。
   *  ***refined-logging*** - クローラー・ログの参照に必要な情報およびコネクターが正しく機能するために必要な情報のみをログに記録します。これがデフォルト値です。
   *  ***minimal-logging*** - コネクターが正しく機能するために必要な最小限の情報のみをログに記録します。

   このオプションを minimal-logging に設定すると、ログのサイズが小さくなり、ログに記録されるデータ量が最少化されて入出力が減少するため、パフォーマンスが若干向上します。
*  **ssl-version** - HTTPS 接続に使用する SSL のバージョンを指定します。デフォルトでは、使用可能な最強のプロトコルが使用されます。

Box コネクターには以下のような制限事項があります。

* ファイルのコメントやタスクは取得されません。
* Lotus Notes のコンテンツ本体は JSON で取得されます。Lotus Notes データをさらに変換しなければならない場合もあります。
* TestIt で個々の文書を取得することはできません。TestIt で取得できるのは、シード URL、フォルダー URL、ユーザー URL に限られます。


## 関連資料

crawler(1)

vcrypt(1)

crawler.conf(5)

crawler-seed.conf(5)

orchestration_service.conf(5)
